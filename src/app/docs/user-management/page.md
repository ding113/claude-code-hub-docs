---
dimensions:
  type:
    primary: operational
    detail: management
  level: intermediate
standard_title: 用户与 API Key 管理
language: zh
---

# 用户与 API Key 管理

Claude Code Hub 提供完整的用户和 API Key 管理功能，支持多用户场景下的权限控制、配额限制和密钥生命周期管理。

---

## 用户管理

### 创建用户

管理员可以通过仪表盘创建新用户：

1. 进入 **Dashboard > Users** 页面
2. 点击 **添加用户** 按钮
3. 填写用户信息：

| 字段 | 说明 | 是否必填 |
|------|------|----------|
| 用户名 | 用户的显示名称 | 是 |
| 备注 | 用户描述信息 | 否 |
| 供应商分组 | 指定用户可使用的供应商组 | 否 |
| RPM 限制 | 每分钟请求数限制 | 是（默认 60） |
| 日配额 | 每日消费上限（美元） | 是（默认 100） |

4. 点击 **确认** 完成创建

创建用户时，系统会自动生成一个名为 `default` 的初始 API Key。

### 编辑用户信息

1. 在用户列表中找到目标用户
2. 点击用户卡片右上角的 **编辑** 按钮
3. 修改需要更新的字段
4. 点击 **保存** 应用更改

**可编辑字段**：
- 用户名
- 备注
- 供应商分组
- RPM 限制
- 日配额
- 各类消费限额（5小时/周/月）
- 并发 Session 限制

> **权限说明**：普通用户只能修改自己的部分信息（如备注），无法修改配额相关设置。

### 禁用/启用用户

目前系统通过 API Key 的启用/禁用状态来控制用户访问：

1. 禁用用户的所有 API Key 即可阻止其访问
2. 重新启用 Key 恢复访问权限

### 删除用户

> **注意**：删除操作为软删除，数据不会立即从数据库移除。

1. 在用户列表找到目标用户
2. 点击 **删除** 按钮
3. 在确认对话框中点击 **确认删除**

删除用户时，其关联的所有 API Key 也会被标记为删除。

---

## API Key 管理

### 生成 API Key

每个用户可以拥有多个 API Key，便于区分不同使用场景。

1. 在用户详情页面，找到 **密钥** 区域
2. 点击 **添加密钥** 按钮
3. 填写密钥信息：

| 字段 | 说明 |
|------|------|
| 密钥名称 | 用于标识密钥用途（如 "开发环境"、"生产环境"） |
| 过期时间 | 可选，不设置则永不过期 |
| Web UI 登录权限 | 是否允许使用该 Key 登录仪表盘 |

4. 点击 **确认** 生成密钥

> **重要**：新生成的密钥只会显示一次，请立即复制保存。格式为 `sk-` 开头的 32 位十六进制字符串。

### Key 权限设置

API Key 支持以下权限配置：

**Web UI 登录权限**
- 启用后，该 Key 可用于登录仪表盘界面
- 禁用则只能用于 API 调用

**限额继承与覆盖**

Key 级别的限额不能超过用户级别的限额：

```
Key 限额 <= 用户限额
```

如果尝试设置超过用户限额的值，系统会返回错误提示。

### Key 有效期

支持两种有效期模式：

1. **永不过期**：不设置过期时间
2. **指定日期过期**：设置具体的过期日期

过期的 Key 将无法用于 API 调用，但不会自动删除，可以通过编辑重新设置有效期来恢复使用。

### 吊销 Key

**禁用密钥**（临时吊销）：
1. 在密钥列表找到目标密钥
2. 点击状态开关切换为 **禁用**
3. 该密钥立即失效，但可随时重新启用

**删除密钥**（永久吊销）：
1. 点击密钥的 **删除** 按钮
2. 确认删除操作

> **限制**：每个用户至少需要保留一个可用的密钥，无法删除最后一个密钥。

---

## 配额设置

Claude Code Hub 支持多维度的配额限制，帮助控制成本和防止滥用。

### 用户级别限额

在用户设置中可配置以下限额：

| 限额类型 | 说明 | 默认值 |
|----------|------|--------|
| RPM | 每分钟请求数 | 60 |
| 日配额 | 每日消费上限（美元） | 100 |
| 5小时限额 | 滚动5小时消费上限 | 无限制 |
| 周限额 | 每周消费上限 | 无限制 |
| 月限额 | 每月消费上限 | 无限制 |
| 并发 Session | 同时活跃的 Session 数量 | 无限制 |

### Token 限制

Token 消费通过金额限额间接控制。系统会根据实际使用的模型和 Token 数量计算费用，当累计费用达到限额时，后续请求将被拒绝。

**Token 类型统计**：
- 输入 Token（Input Tokens）
- 输出 Token（Output Tokens）
- 缓存创建 Token（Cache Creation Tokens）
- 缓存读取 Token（Cache Read Tokens）

### 请求频率限制

**RPM（每分钟请求数）限制**：
- 基于滑动窗口实现
- 超出限制时返回 429 状态码
- 建议客户端实现退避重试机制

**配额重置时间**：
- 日限额：每日 00:00（系统时区）重置
- 周限额：每周一 00:00 重置
- 月限额：每月1日 00:00 重置
- 5小时限额：滚动窗口，持续计算

### Key 级别限额

每个 API Key 可以设置独立的限额，用于更精细的成本控制：

| 限额类型 | 说明 |
|----------|------|
| 5小时限额 | 该 Key 的5小时消费上限 |
| 日限额 | 该 Key 的每日消费上限 |
| 周限额 | 该 Key 的每周消费上限 |
| 月限额 | 该 Key 的每月消费上限 |
| 并发 Session | 该 Key 的并发 Session 数量限制 |

**日限额重置模式**：
- **固定时间（fixed）**：在指定时间点重置（如每日 00:00）
- **滚动窗口（rolling）**：从首次使用开始计算24小时

---

## 权限控制

### 管理员权限

管理员（role: `admin`）拥有完整的系统管理权限：

- 查看所有用户信息和统计数据
- 创建、编辑、删除用户
- 管理所有用户的 API Key
- 修改用户配额设置
- 查看全局使用日志和排行榜
- 访问系统配置页面
- 管理供应商配置
- 查看供应商可用性监控

### 普通用户权限

普通用户（role: `user`）的权限受到限制：

**可执行操作**：
- 查看自己的用户信息
- 修改自己的部分信息（如备注）
- 查看和管理自己的 API Key
- 查看自己的使用日志
- 查看自己的 Session 列表

**不可执行操作**：
- 查看其他用户信息
- 修改配额相关设置
- 访问全局统计和排行榜（除非系统设置允许）
- 管理供应商配置

### 只读权限

目前系统未实现独立的只读角色。如需只读访问，建议：

1. 创建普通用户账户
2. 仅授予 Web UI 登录权限的 Key
3. 不分享可用于 API 调用的 Key

---

## 最佳实践

### API Key 管理建议

1. **按环境分离**：为开发、测试、生产环境创建不同的 Key
2. **定期轮换**：设置合理的过期时间，定期更换密钥
3. **最小权限**：仅在需要时启用 Web UI 登录权限
4. **命名规范**：使用清晰的命名标识 Key 用途

### 配额设置建议

1. **逐步放宽**：从较低的限额开始，根据实际使用情况逐步调整
2. **分层限制**：结合用户和 Key 级别限额实现精细控制
3. **监控预警**：定期检查使用统计，在接近限额时及时调整
4. **成本预算**：根据预算设置月限额，防止超支

### 安全建议

1. **保护密钥**：不要在代码中硬编码 API Key
2. **使用环境变量**：通过环境变量传递 Key
3. **限制来源**：考虑配合网络策略限制 API 调用来源
4. **及时吊销**：发现密钥泄露时立即禁用或删除
