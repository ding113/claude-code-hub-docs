---
dimensions:
  type:
    primary: getting-started
    detail: settings
  level: beginner
standard_title: 配置
language: zh
---

# 配置

配置页面允许团队管理员对系统进行全局设置，包括站点参数、代理链路的可靠性开关以及日志自动清理策略。合理的配置能够提升团队使用体验、增强兼容性并有效管理系统资源。

## 访问配置页面

1. 登录管理后台
2. 在左侧导航栏选择「设置」
3. 点击「配置」子菜单

## 站点参数配置

站点参数配置包含系统的基础设置，影响整体展示效果和计费方式。

### 站点标题

自定义系统的显示名称，该名称会显示在浏览器标签页和页面标题中。

- **字段类型**：文本输入
- **最大长度**：128 个字符
- **默认值**：Claude Code Hub

### 货币显示

选择系统中金额数据的显示货币单位。支持的货币包括：

| 货币代码 | 货币名称 | 符号 |
| --- | --- | --- |
| USD | 美元 | $ |
| CNY | 人民币 | ¥ |
| EUR | 欧元 | € |
| JPY | 日元 | ¥ |
| GBP | 英镑 | £ |
| HKD | 港币 | HK$ |
| TWD | 新台币 | NT$ |
| KRW | 韩元 | ₩ |
| SGD | 新加坡元 | S$ |

> **注意**：货币显示设置仅影响界面展示，不会进行实际的汇率换算。所有内部计算仍以 USD 为基准。

### 计费模型来源

配置计费时使用的模型名称来源：

- **重定向前（original）**：使用客户端请求的原始模型名称进行计费
- **重定向后（redirected）**：使用经过供应商模型重定向后的实际模型名称进行计费

当供应商配置了模型重定向时，此选项决定了成本计算依据哪个模型的价格。

### 允许全局使用情况查看

开启后，普通用户可以在仪表盘查看全局使用统计数据。关闭时，用户只能查看自己的使用数据。

- **默认值**：关闭
- **适用场景**：团队透明度较高，希望成员了解整体使用情况时可开启

### 启用 HTTP/2

控制代理请求是否使用 HTTP/2 协议。

- **字段类型**：开关
- **默认值**：关闭

| 状态 | 说明 |
| --- | --- |
| 关闭 | 使用 HTTP/1.1 协议（默认，兼容性更好） |
| 开启 | 启用 HTTP/2 协议（性能更优，自动降级） |

{% callout type="note" title="自动降级" %}
启用 HTTP/2 后，如果连接失败会自动回退到 HTTP/1.1。SOCKS 代理不支持 HTTP/2，会强制使用 HTTP/1.1。
{% /callout %}

### 拦截 Anthropic Warmup 请求

控制是否拦截 Claude Messages API 的 Warmup 探测请求（默认关闭）。

当开启后，系统会在识别到 Warmup 请求时：

- **不转发上游**：由 Claude Code Hub 直接返回最小合法响应
- **不计费 / 不限流 / 不计入统计**：该类请求用于客户端探测，不应污染成本与配额
- **仍会写入日志**：方便排查与审计（会标记为 warmup 拦截）

{% callout type="note" title="Warmup 请求判定（尽量严格）" %}
系统仅在请求满足以下特征时才会判定为 Warmup 并尝试拦截：端点为 `POST /v1/messages`，消息只有 1 条且为 user，content 为单个 text block 且文本为 `Warmup`（忽略大小写/空格），并且 `cache_control.type = ephemeral`。
{% /callout %}

### Thinking Signature 整流器

控制是否启用「thinking signature 整流器」（默认开启）。

它用于解决 Anthropic 供应商链路中常见的 thinking 兼容性问题，例如：

- 跨渠道/跨供应商切换导致的 `signature` 字段不兼容
- thinking 已启用，但工具调用续写的 assistant 消息未以 thinking/redacted_thinking 开头（典型错误为 “Expected thinking … but found tool_use”）

当命中相关错误特征时，系统会对请求体做最小侵入整流（移除/清理相关字段）并对**同一供应商重试一次**，以避免无意义的故障转移与熔断污染。整流命中会在 Session 详情与日志中以 `specialSettings` 记录，便于排查。

### 响应修复器（Response Fixer）

控制是否启用「响应修复器」（默认开启）。

响应修复器用于在代理返回给客户端之前，自动修复一些上游响应的常见问题（避免客户端解析失败或 SSE 中断），包括：

- **截断 JSON 修复**：尝试修复被截断的 JSON 响应
- **SSE 格式修复**：修复不规范的 `text/event-stream` 分段格式
- **异常编码修复**：处理非预期编码导致的乱码/解析异常

开启响应修复器后，你可以在界面中分别开关上述三项修复能力，以便在“兼容性收益”和“最小改动”之间做取舍。

该功能主要用于提升兼容性与稳定性；命中与修复细节同样会记录到 `specialSettings`（便于审计与排查）。

### 供应商错误详细信息

控制当没有可用供应商时返回给客户端的错误信息详细程度。

- **字段类型**：开关
- **默认值**：关闭

| 状态 | 说明 |
| --- | --- |
| 关闭 | 返回简洁错误信息（"No available providers"），保护内部架构 |
| 开启 | 返回详细错误诊断，包含每个供应商的过滤原因（限流、熔断等） |

{% callout type="warning" title="安全提示" %}
生产环境建议保持关闭，避免向客户端暴露供应商架构信息。开发/调试环境可开启以便排查问题。
{% /callout %}

## 自动清理配置

自动清理功能用于定期清理历史请求日志，防止数据库过度增长。

### 启用自动清理

总开关，控制是否启用日志自动清理功能。

- **默认值**：关闭
- **建议**：长期运行的生产环境建议开启

### 保留天数

设置日志的保留期限，超过此期限的日志将被自动删除。

- **取值范围**：1 - 365 天
- **默认值**：30 天
- **建议**：根据合规要求和存储空间综合考虑，一般建议保留 30-90 天

### 清理计划（Cron 表达式）

使用 Cron 表达式设置清理任务的执行时间。

- **默认值**：`0 2 * * *`（每天凌晨 2 点执行）
- **格式说明**：`分钟 小时 日期 月份 星期`

常用示例：

| Cron 表达式 | 含义 |
| --- | --- |
| `0 2 * * *` | 每天凌晨 2:00 |
| `0 3 * * 0` | 每周日凌晨 3:00 |
| `0 4 1 * *` | 每月 1 日凌晨 4:00 |

> **建议**：选择系统低峰期执行清理任务，避免影响正常使用。

### 批量大小

每次清理操作删除的最大记录数，用于控制单次清理对数据库的压力。

- **取值范围**：1,000 - 100,000
- **默认值**：10,000
- **建议**：
  - 数据量较小时可设置较大值以加快清理速度
  - 数据量较大时建议使用较小值，分多次清理

## 保存配置

完成配置修改后，点击对应区块的「保存」按钮提交更改。

- 站点参数保存后会自动刷新页面以应用货币显示变更
- 自动清理配置保存后立即生效，下次到达计划时间时开始执行

## 最佳实践

1. **初次部署时**：建议先设置好站点标题和货币显示，便于团队识别
2. **生产环境**：务必开启自动清理，避免日志数据无限增长
3. **保留天数**：根据审计需求设置合理值，既满足回溯需要又不占用过多存储
4. **清理时间**：选择凌晨低峰期，批量大小根据服务器性能适当调整
