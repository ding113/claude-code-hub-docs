---
dimensions:
  type:
    primary: getting-started
    detail: dashboard
  level: beginner
standard_title: 限流监控
language: zh
---

# 限流监控

限流监控页面提供了对系统限流事件的全面统计和可视化分析，帮助管理员了解限流触发情况、受影响的用户以及不同限流类型的分布。

{% callout type="note" title="访问权限" %}
限流监控页面仅对管理员开放。普通用户将被自动重定向到仪表盘首页。
{% /callout %}

---

## 页面入口

在管理后台侧边栏中，点击「限额管理」下的相关菜单项即可进入限流监控页面。

---

## 核心功能

### 数据筛选器

页面顶部提供了多维度的数据筛选功能，支持以下过滤条件：

| 筛选项 | 说明 |
|--------|------|
| **开始时间** | 选择查询的起始时间点 |
| **结束时间** | 选择查询的结束时间点 |
| **用户** | 筛选特定用户的限流事件 |
| **供应商** | 筛选特定供应商相关的限流事件 |
| **限流类型** | 按限流类型筛选（RPM、5小时消费等） |

默认情况下，页面显示过去 7 天的所有限流事件数据。点击「应用筛选」按钮提交筛选条件，或点击「重置」按钮恢复默认设置。

---

### 总览卡片

筛选器下方展示三个核心指标卡片：

| 指标 | 说明 |
|------|------|
| **总事件数** | 在选定时间范围内发生的限流事件总数 |
| **平均使用率** | 触发限流时的平均资源使用百分比 |
| **受影响用户数** | 在选定时间范围内触发过限流的用户数量 |

---

### 限流事件时间线

使用面积图展示限流事件随时间的分布趋势，按小时进行聚合统计。

**图表特性：**
- X 轴：时间（精确到小时）
- Y 轴：限流事件数量
- 渐变填充：直观展示事件密度变化
- 悬浮提示：鼠标悬停显示具体时间点的事件数量

通过此图表，您可以快速识别限流事件的高峰时段，为容量规划和限额调整提供依据。

---

### 限流类型分布

使用饼图展示不同限流类型的事件占比，帮助您了解哪种类型的限流最常被触发。

**支持的限流类型：**

| 限流类型 | 说明 |
|----------|------|
| **RPM 限流** | 每分钟请求数超过限制 |
| **5小时消费限流** | 5 小时滚动窗口内消费金额超过限制 |
| **周消费限流** | 每周消费金额超过限制 |
| **月消费限流** | 每月消费金额超过限制 |
| **并发 Session 限流** | 同时活跃的会话数超过限制 |
| **每日额度限流** | 用户每日消费额度超过限制 |

**图表特性：**
- 扇形比例：反映各类型事件的占比
- 图例说明：快速识别各类型颜色
- 悬浮提示：显示具体事件数和百分比

---

### 受影响用户排行

以表格形式展示触发限流最多的用户列表，支持排序功能。

**表格字段：**

| 字段 | 说明 |
|------|------|
| **排名** | 根据事件数量的排名位置 |
| **用户名** | 触发限流的用户名称 |
| **事件数** | 该用户触发的限流事件总数 |
| **占比** | 该用户事件数占总事件数的百分比 |

**排序功能：**
- 点击「用户名」列标题可按用户名升序/降序排列
- 点击「事件数」列标题可按事件数升序/降序排列

默认按事件数降序排列，将触发限流最频繁的用户排在前面。

---

## 限流指标说明

Claude Code Hub 支持多种维度的限流控制，以下是各限流指标的详细说明：

### RPM（每分钟请求数）

限制用户每分钟可发送的 API 请求数量。使用 Redis ZSET 实现滑动窗口算法，精确统计过去 60 秒内的请求数。

**配置位置：** 用户管理 > 编辑用户 > RPM 限制

### 金额限制

系统支持多个时间维度的消费金额限制：

| 限额类型 | 时间窗口 | 重置机制 |
|----------|----------|----------|
| **5小时限额** | 滚动 5 小时 | 滚动窗口，持续滑动 |
| **每日限额** | 24 小时 | 支持固定时间重置或滚动窗口 |
| **周限额** | 自然周 | 每周一 00:00 重置 |
| **月限额** | 自然月 | 每月 1 日 00:00 重置 |

**配置位置：**
- 用户限额：用户管理 > 编辑用户
- 密钥限额：密钥管理 > 编辑密钥
- 供应商限额：供应商管理 > 编辑供应商

{% callout type="note" title="限额优先级" %}
当用户限额和密钥限额同时存在时，系统会取两者中更严格的限制。
{% /callout %}

### 并发 Session 限制

限制用户或供应商同时活跃的会话数量。Session 在最后活动 5 分钟后自动失效。

**配置位置：**
- 用户级：用户管理 > 编辑用户 > 并发 Session 上限
- 密钥级：密钥管理 > 编辑密钥 > 并发 Session 上限
- 供应商级：供应商管理 > 编辑供应商 > 并发 Session 限制

---

## 限流触发行为

当请求触发限流时，系统将：

1. 返回 HTTP 429 状态码
2. 在响应中包含限流原因说明
3. 记录限流事件到数据库（用于本页面统计）
4. 在日志中记录详细信息

{% callout type="warning" title="Fail-Open 策略" %}
当 Redis 不可用时，系统采用 Fail-Open 策略，即允许请求通过而不是拒绝。这确保了 Redis 临时故障不会影响正常服务。
{% /callout %}

---

## 空状态处理

当选定的时间范围内没有限流事件时，页面会显示空状态提示：「暂无数据 - 在选定的时间范围内没有限流事件」。

这表明：
- 当前配置的限额足够宽松
- 用户使用量未超过限制
- 或者选择的时间范围内确实没有触发限流

---

## 最佳实践

1. **定期检查限流统计**：建议每周查看一次限流监控，了解系统负载情况
2. **关注高频用户**：对触发限流较多的用户，考虑是否需要调整其限额配置
3. **分析限流类型分布**：如果某类限流频繁触发，可能需要调整相应的全局策略
4. **结合时间线分析**：通过时间线图表识别限流高峰期，合理规划资源

---

## 相关功能

- [用户配额](/docs/guide/quotas-users) - 查看用户维度的限额使用情况
- [用户管理](/docs/guide/users) - 配置用户级别的限流参数
- [供应商管理](/docs/guide/settings-providers) - 配置供应商级别的限流参数
